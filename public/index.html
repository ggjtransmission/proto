<!DOCTYPE html>
<html>
<head>
   <title>
      Plague Party!
   </title>
   <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
   <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-colors-flat.css">
   <meta name="viewport" content="width=device-width, initial-scale=1">

   <script src="http://code.jquery.com/jquery-2.2.4.min.js"></script>
   <script type="text/javascript">
      s = new WebSocket("ws://"+location.hostname+":" + location.port);

      s.onopen = function(){
         console.log("Opened Socket");
      }

      s.onclosed = function(){
         console.log("Closed Socket");
      }

      s.onmessage = function(m)
      {
         var data = JSON.parse(m.data);
         processMessage(data);
      }

      function processMessage(data)
      {
         console.log("message data: " + data)
         switch(data.type)
         {
            case "time":
            // console.log("update time");
               updateTime(data.message);
            break;
            case "register":

            break;
         }
      }

      //Adds a user to the game.
      function register() {
         console.log("Call register function")
         var messageObject = {
            type: "register",
            name: $("#player_name").val()
         }
         s.send(JSON.stringify(messageObject));
      }

      //When going back to home page, resets game status.
      function goHome() {
         console.log("return to home from join")
         var messageObject = {
            type: "returnHome",
         }
         s.send(JSON.stringify(messageObject));
      }

      function sendStart(){
            var messageObject = {
            type: "start",
         }
         s.send(JSON.stringify(messageObject));
      }

      function updateTime(time){
         var min = Math.floor(time / 60);
         var sec = time - min * 60;
         var prettyTime = min + ":" + sec;
         $("#timeRemaining").html(prettyTime);
      }

      $(document).ready(function(){
         // $(register_button).click(function()
         // {
         //    register();
         // })

         // $(start_game).click(function(){
         //    sendStart();
         // })

         $("#join_button").click(function(){
            console.log("Clicked join button registering the user")
            switchPage("lobby_page");
            register();
         });

         $("#create-game_button").click(function(){
            switchPage("join_page");
         });

         $("#instructions_button").click(function(){
            console.log("show instructions");
         });

         $("#credits_button").click(function(){
            console.log("show credits");
            goHome();
            switchPage("start_page");
         });

      })

      function switchPage(pageId)
      {
         console.log("page Id  = " + pageId)
         $(".page").hide();
         $("#"+pageId).show();
      }

   </script>

   <script type="text/javascript">
function togglemusic() {
  if (document.getElementById("soundtoggle").checked == true) {
    document.getElementById("backgroundmusic").play();
  }
  else {
    document.getElementById("backgroundmusic").pause();
  }
}

var squish = new Audio("zapsplat_cartoon_squish_squelch_wet_001_14500.mp3");
   </script>

</head>
<body>

<header class="w3-container w3-flat-midnight-blue">
   <label class="container">sound
     <input id="soundtoggle" type="checkbox" onclick="togglemusic()"/>
   </label>
   <audio id="backgroundmusic" src="Devil_Music_-_37_-_Plague.mp3" preload="auto" hidden controls></audio>
   <center>
      <h1><i>Plague Party!</i></h1>
   </center>
</header>

<!-- Home page -->
<div class="w3-cell-row">
  <div class="w3-cell">
  </div>
  <div class="w3-cell w3-container">
   <div class="page" id="start_page" >
      <center>
         <p>The game of socially transmitted diseases.</p>
         <img src="PlagueParty2.png" alt="" width="363" height="388.5">
         <button id="create-game_button">Create Game</button>
         <button id="squishsound" onclick="squish.play()">SQUISH</button>
      </center>
   </div>   
  </div>
</div>

<!-- Join page -->
<div class="w3-cell-row">
  <div class="w3-cell">
  </div>
  <div class="w3-cell w3-container">
   <div hidden class="page" id="join_page" >

      <p>Enter Your name: <input id="player_name" type="text" name="name"/></p>
      <center>
         <button id="join_button">Join Game</button>
      </center>
   </div>
  </div>
</div>

<!-- Lobby page -->
<div class="w3-cell-row">
  <div class="w3-cell">
  </div>
  <div class="w3-cell w3-container">
   <div hidden  class="page" id="lobby_page" >
      <center>
      <p>A breakout has occured ...</p>
      <p>Waiting for game to start</p>
      <p>A breakout has occured ...</p>
      </center>
   </div>
  </div>
</div>

<!-- Game in progress page -->
<div class="w3-cell-row">
  <div class="w3-cell">
  </div>
  <div class="w3-cell w3-container">
   <div hidden class="page" id="game_in_progress_page" >
      <center>
      <p>Game</p>
      <p>in</p>
      <p>progress</p>
      </center>
   </div>
  </div>
</div>

<footer class="w3-container w3-flat-midnight-blue">
  <button id="instructions_button">Instructions</button>
  <button id="credits_button">Credits</button>
</footer>


</body>
</html>
