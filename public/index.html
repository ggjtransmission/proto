<!DOCTYPE html>
<html>
<head>
   <title>
      Plague Party!
   </title>
   <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
   <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-colors-flat.css">
   <meta name="viewport" content="width=device-width, initial-scale=1">

   <script src="http://code.jquery.com/jquery-2.2.4.min.js"></script>
   <script type="text/javascript">
      s = new WebSocket("ws://"+location.hostname+":" + location.port);

      var curPage = "start_page";
      var prevPage = "start_page";

      s.onopen = function(){
         console.log("Opened Socket");
      }

      s.onclosed = function(){
         console.log("Closed Socket");
      }

      s.onmessage = function(m)
      {
         var data = JSON.parse(m.data);
         console.log(m.data)
         processMessage(data);
      }

      function processMessage(data)
      {
         console.log("message data: " + data)
         switch(data.type)
         {
            case "reset":
               document.location = "/";
            break;
            case "newconnection":
               console.log("new connection %o", data);
               if (data.game_exists) {
                  if (data.game_running) {
                     switchPage("game_in_progress_page");
                  }
                  else {
                     switchPage("join_page");
                  }
               }
               else {
                  switchPage("start_page");
               }
            break;
            case "time":
            // console.log("update time");
               updateTime(data.message);
               //Updates the counter of registered players
               $("#player_count").text(data.numberOfRegisteredPlayers + " / " + data.maxNumberOfPlayers);  
               $("#player_count1").text(data.numberOfRegisteredPlayers + " / " + data.maxNumberOfPlayers);   
            break;
            case "register":
               //Updates the counter of registered players
               $("#player_count").text(data.numberOfRegisteredPlayers + " / " + data.maxNumberOfPlayers);  
               $("#player_count1").text(data.numberOfRegisteredPlayers + " / " + data.maxNumberOfPlayers);            
               console.log("data.message " + data.numberOfRegisteredPlayers)
            break;
            case "gamecreated":
               // someone has created a new game
               switchPage("join_page");
            break;
         }
      }

      //Adds a user to the game.
      function register() {
         console.log("Call register function")
         #("player_code").text($("#player_name"));
         var messageObject = {
            type: "register",
            name: $("#player_name").val()
         }
         s.send(JSON.stringify(messageObject));
      }

      //When going back to home page, resets game status.
      function goHome() {
         console.log("return to home from join")
         var messageObject = {
            type: "killGame",
         }
         s.send(JSON.stringify(messageObject));
      }

      function sendStart(){
            var messageObject = {
            type: "start",
         }
         s.send(JSON.stringify(messageObject));
      }

      function updateTime(time){
         var min = Math.floor(time / 60);
         var sec = time - min * 60;
         var prettyTime = min + ":" + sec;
         $("#timeRemaining").html(prettyTime);
      }

      $(document).ready(function(){
         // $(register_button).click(function()
         // {
         //    register();
         // })

         // $(start_game).click(function(){
         //    sendStart();
         // })

         $("#join_button").click(function(){
            console.log("Clicked join button registering the user")
            switchPage("lobby_page");
            register();
         });

         $("#create-game_button").click(function(){
            var messageObject = {
               type: "create",
            }
            s.send(JSON.stringify(messageObject));
         });

         $("#instructions_button").click(function(){
            console.log("show instructions");
            $("#footer").hide();
            $("#close_button").show();
            $("#headerText").text("Instructions");   
            prevPage =  curPage;
            switchPage("instructions_page");
         });

         $("#credits_button").click(function(){
            console.log("show credits");
            $("#footer").hide();
            $("#subpageFooter").show();
            $("#close_button").show();
            $("#headerText").text("Credits"); 
            prevPage =  curPage;
            switchPage("credits_page");
         });

         $("#kill_button").click(function(){
            console.log("show credits");
            $("#footer").show();
            $("#subpageFooter").hide();
            $("#close_button").hide();
            $("#headerText").text("Plague Party");
            goHome();
            switchPage("start_page");
         });

         $("#close_button").click(function(){
            $("#footer").show();
            $("#subpageFooter").hide();
            $("#close_button").hide();
            $("#headerText").text("Plague Party");
            switchPage(prevPage);
         });

      })

      function switchPage(pageId)
      {
         prevPage =  curPage;
         curPage = pageId;
         console.log("page Id  = " + pageId)
         $(".page").hide();
         $("#"+pageId).show();
      }

   </script>

   <script type="text/javascript">
function togglemusic() {
  if (document.getElementById("soundtoggle").checked == true) {
    document.getElementById("backgroundmusic").play();
  }
  else {
    document.getElementById("backgroundmusic").pause();
  }
}

var squish = new Audio("zapsplat_cartoon_squish_squelch_wet_001_14500.mp3");
   </script>

</head>
<body>

<header class="w3-container w3-flat-midnight-blue">
   <label class="container">sound
     <input id="soundtoggle" type="checkbox" onclick="togglemusic()"/>
   </label>
   <audio id="backgroundmusic" src="Devil_Music_-_37_-_Plague.mp3" preload="auto" hidden controls></audio>
   <center>
      <h1 id=headerText><i>Plague Party!</i></h1>
   </center>
   <right>      
      <button hidden id="close_button" >X</button>
   </right>
</header>

<!-- Home page -->
<div class="w3-cell-row">
  <div class="w3-cell">
  </div>
  <div class="w3-cell w3-container">
   <div hidden class="page" id="start_page" >
      <center>
         <p>The game of socially transmitted diseases.</p>
         <img src="PlagueParty2.png" alt="" width="363" height="388.5">
         <button id="create-game_button">Create Game</button>
         <button id="squishsound" onclick="squish.play()">SQUISH</button>
      </center>
   </div>   
  </div>
</div>

<!-- Join page -->
<div class="w3-cell-row">
  <div class="w3-cell">
  </div>
  <div class="w3-cell w3-container">
   <div hidden class="page" id="join_page" >
      <center>
         <p>Enter Your name:</p>
         <input id="player_name" type="text" name="name"/>
         <p id="player_count"> 0 / 4 </p>
         <p>Players Joined</p>
         <button id="join_button">Join Game</button>
      </center>
   </div>
  </div>
</div>

<!-- Lobby page -->
<div class="w3-cell-row">
  <div class="w3-cell">
  </div>
  <div class="w3-cell w3-container">
   <div hidden  class="page" id="lobby_page" >
      <center>
         <p>A breakout has occured ...</p>
         <p>Waiting for game to start</p>
         <p>A breakout has occured ...</p>
         <p id="player_count1"> 0 / 4 </p>
         <p>Players Joined</p>
      </center>
   </div>
  </div>
</div>

<!-- Game in progress page -->
<div class="w3-cell-row">
  <div class="w3-cell">
  </div>
  <div class="w3-cell w3-container">
   <div hidden class="page" id="game_in_progress_page" >
      <center>
      <p>Game</p>
      <p>in</p>
      <p>progress</p>
      </center>
   </div>
  </div>
</div>

<!-- Instructions page -->
<div class="w3-cell-row">
  <div class="w3-cell">
  </div>
  <div class="w3-cell w3-container">
   <div hidden class="page" id="instructions_page" >
      <center>
      <p>Plague Party is The Game of Socially Transmitted Diseases. </p>

      <p>Get your mind out of the gutter, it's social...<br>

      You are all infected with a random disease and have a limited time to find a cure before your time runs out. Unlucky! The winner is the person who finds the cure first by solving the puzzle (finding the cure). But be careful, as examining the other patients and attempting cures can transmit the disease faster.</p>

      <p>Create a game using the create button or join an existing game by pressing join.<br>

      Once a game is started you have a limited time to cure the disease. The mortality bar will show you your current mortality rate. When it hits 100 percent, the world is decimated. The only way to save humanity is to interact with the other players so get out of your comfort zone and meet other people...and talk to them.</p>

      <p>In order to cure the disease you must find the correct sequence and pairs of Humours and Symptoms. Humours are old-timey concepts of medicine. No wonder you're sick! Once you have the correct pairs and sequence you can attempt a cure. But beware, if you're wrong the disease spreads faster.</p>

      <p>To find the clues you need, you'll need to examine the other players for Humours and Symptoms. Find one of the other players and input their player code. Then, press the Examine button. It is customary to introduce yourself and make eye contact! Your shoes are great but you've seen them. Look up.</p> 

      <p>You will receive two pieces of information about the pairs and sequence of the cure. They'll automatically be input into your medical chart. Once you have enough information you can attempt a cure. But be careful, a bad cure guess will accelerate the infection!</p>

      <p>You'll be helped by the automatic collaboration and transmission of any pairs discovered by another player. They'll be immediately transmitted to all players' medical charts, though the correct sequence position will not. You must use what you have discovered along with deductive reasoning, using the common pair information to make an educated guess about the cure pairs and sequence.</p>

      <P>Remember the clock is ticking from the moment the game starts. Examinations spread the disease and wrong guesses spread the disease so pay attention to the mortality rate. Most importantly remember you have to interact with every player!</P>

      <P>Now get out there and...<br><br>

      Mix, Mingle and Mort?!?</p>
      </center>
   </div>
  </div>
</div>

<!-- Credits page -->
<div class="w3-cell-row">
  <div class="w3-cell">
  </div>
  <div class="w3-cell w3-container">
   <div hidden class="page" id="credits_page" >
      <center>
      <p>Text here</p>
      </center>
   </div>
  </div>
</div>

<footer id=footer class="w3-container w3-flat-midnight-blue">
  <button id="instructions_button">Instructions</button>
  <label id="player_code"></label>
  <button id="credits_button">Credits</button>
</footer>

<footer hidden id=subpageFooter class="w3-container w3-flat-midnight-blue">
  <button id="kill_button">Kill</button>
</footer>


</body>
</html>
